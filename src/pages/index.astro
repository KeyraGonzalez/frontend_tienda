---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ProductCard from '../components/ProductCard.astro';
import type { Product } from '../types/types';
import { productsService } from '../utils/api/index';

// Fetch featured products
let featuredProducts: Product[] = [];
let apiError: string | null = null;

try {
  console.log('üîÑ Fetching featured products...');
  const response = await productsService.getProducts();
  console.log('üì¶ Raw products response:', response);
  
  // Handle the correct response format from your backend
  if (response?.products && Array.isArray(response.products)) {
    // Filter featured products or just take the first 8
    featuredProducts = response.products
      .filter(product => product.featured || product.is_featured) // First try featured products
      .slice(0, 8);
    
    // If no featured products, take the first 8 products
    if (featuredProducts.length === 0) {
      featuredProducts = response.products.slice(0, 8);
    }
  } else {
    featuredProducts = [];
  }
  
  console.log('‚úÖ Featured products loaded:', featuredProducts.length);
} catch (error) {
  console.error('‚ùå Error fetching products:', error instanceof Error ? error.message : String(error));
  apiError = error instanceof Error ? error.message : 'Error desconocido al cargar productos';
  featuredProducts = [];
  
  console.log('üîÑ No products loaded, check API connection');
}
---

<Layout 
  title="StyleHub - Tu tienda de moda online"
  description="Descubre las √∫ltimas tendencias en moda. Encuentra ropa, zapatos y accesorios de las mejores marcas al mejor precio."
>
  <Header />
  
  <main>
    <!-- Hero Section -->
    <section class="relative overflow-hidden text-white min-h-screen">
      <!-- Moving Background Images -->
      <div class="absolute inset-0">
        <div class="hero-slider">
          <div class="hero-slide active" style="background-image: url('/imagen-01.png')"></div>
          <div class="hero-slide" style="background-image: url('/imagen-02.png')"></div>
          <div class="hero-slide" style="background-image: url('/imagen-03.png')"></div>
        </div>
      </div>
      
      <!-- Dark overlay for text readability -->
      <div class="absolute inset-0 bg-black bg-opacity-50"></div>
      
      <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24 lg:py-32 min-h-screen flex items-center">
        <div class="max-w-3xl">
          <h1 class="text-4xl md:text-6xl font-bold leading-tight mb-6 tracking-wide uppercase">
            Descubre tu 
            <span class="text-gray-300">estilo √∫nico</span>
          </h1>
          <p class="text-xl md:text-2xl text-gray-200 mb-8 leading-relaxed font-medium">
            Las √∫ltimas tendencias en moda, calidad premium y precios incre√≠bles. Todo en un solo lugar.
          </p>
          <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
            <a 
              href="/productos" 
              class="bg-transparent border-2 border-white text-white px-8 py-4 rounded-lg font-bold text-lg hover:bg-white hover:text-black transition-colors text-center tracking-wide uppercase"
            >
              Explorar Productos
            </a>
           
          </div>
        </div>
      </div>
      
      <!-- Hero decorative elements -->
      <div class="absolute bottom-0 right-0 w-1/3 h-full opacity-10 z-5">
        <div class="w-full h-full bg-gradient-to-tl from-gray-400 to-transparent"></div>
      </div>
    </section>

    <!-- Features Section -->
    <section class="py-16 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div class="text-center">
            <div class="w-16 h-16 bg-black rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
              </svg>
            </div>
            <h3 class="text-xl font-bold text-black mb-2 tracking-wide uppercase">Env√≠o Gratuito</h3>
            <p class="text-gray-600 font-medium">En compras mayores a $100. Entrega en 2-3 d√≠as h√°biles.</p>
          </div>
          
          <div class="text-center">
            <div class="w-16 h-16 bg-black rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h3 class="text-xl font-bold text-black mb-2 tracking-wide uppercase">Garant√≠a de Calidad</h3>
            <p class="text-gray-600 font-medium">30 d√≠as de garant√≠a en todos nuestros productos.</p>
          </div>
          
          <div class="text-center">
            <div class="w-16 h-16 bg-black rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
              </svg>
            </div>
            <h3 class="text-xl font-bold text-black mb-2 tracking-wide uppercase">Pago Seguro</h3>
            <p class="text-gray-600 font-medium">M√∫ltiples m√©todos de pago con m√°xima seguridad.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Featured Products -->
    <section class="py-16 bg-gray-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-black mb-4 tracking-wide uppercase">
            Productos Destacados
          </h2>
          <p class="text-lg text-gray-600 max-w-2xl mx-auto font-medium">
            Descubre nuestra selecci√≥n especial de productos m√°s populares y tendencias actuales
          </p>
        </div>

        {featuredProducts.length > 0 ? (
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            {featuredProducts.map(product => (
              <ProductCard product={product} />
            ))}
          </div>
        ) : (
          <div class="text-center py-12">
            <p class="text-gray-500 text-lg font-medium">No hay productos disponibles en este momento.</p>
          </div>
        )}

        <div class="text-center">
          <a 
            href="/productos" 
            class="bg-black text-white px-8 py-3 rounded-lg font-bold hover:bg-gray-800 transition-colors inline-block tracking-wide uppercase border border-black"
          >
            Ver Todos los Productos
          </a>
        </div>
      </div>
    </section>

    <!-- Categories Section -->
    <section class="py-16 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-black mb-4 tracking-wide uppercase">
            Compra por Categor√≠a
          </h2>
          <p class="text-lg text-gray-600 font-medium">
            Encuentra exactamente lo que buscas
          </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6">
          <a href="/productos?categoria=camisetas" class="group">
            <div class="bg-gray-50 border border-gray-200 rounded-lg hover:shadow-md transition-shadow overflow-hidden">
              <div class="h-48 bg-cover bg-center relative" style="background-image: url('/camisa.jpg')">
                <div class="absolute inset-0 bg-black bg-opacity-30 group-hover:bg-opacity-20 transition-all"></div>
              </div>
              <div class="p-4 text-center">
                <h3 class="font-bold text-black group-hover:text-gray-600 transition-colors tracking-wide uppercase">Camisetas</h3>
              </div>
            </div>
          </a>

          <a href="/productos?categoria=pantalones" class="group">
            <div class="bg-gray-50 border border-gray-200 rounded-lg hover:shadow-md transition-shadow overflow-hidden">
              <div class="h-48 bg-cover bg-center relative" style="background-image: url('/pantalon.jpg')">
                <div class="absolute inset-0 bg-black bg-opacity-30 group-hover:bg-opacity-20 transition-all"></div>
              </div>
              <div class="p-4 text-center">
                <h3 class="font-bold text-black group-hover:text-gray-600 transition-colors tracking-wide uppercase">Pantalones</h3>
              </div>
            </div>
          </a>

          <a href="/productos?categoria=vestidos" class="group">
            <div class="bg-gray-50 border border-gray-200 rounded-lg hover:shadow-md transition-shadow overflow-hidden">
              <div class="h-48 bg-cover bg-center relative" style="background-image: url('/vestidos.png')">
                <div class="absolute inset-0 bg-black bg-opacity-30 group-hover:bg-opacity-20 transition-all"></div>
              </div>
              <div class="p-4 text-center">
                <h3 class="font-bold text-black group-hover:text-gray-600 transition-colors tracking-wide uppercase">Vestidos</h3>
              </div>
            </div>
          </a>

          <a href="/productos?categoria=zapatos" class="group">
            <div class="bg-gray-50 border border-gray-200 rounded-lg hover:shadow-md transition-shadow overflow-hidden">
              <div class="h-48 bg-cover bg-center relative" style="background-image: url('/zapatos.jpeg')">
                <div class="absolute inset-0 bg-black bg-opacity-30 group-hover:bg-opacity-20 transition-all"></div>
              </div>
              <div class="p-4 text-center">
                <h3 class="font-bold text-black group-hover:text-gray-600 transition-colors tracking-wide uppercase">Zapatos</h3>
              </div>
            </div>
          </a>

          <a href="/productos?categoria=accesorios" class="group">
            <div class="bg-gray-50 border border-gray-200 rounded-lg hover:shadow-md transition-shadow overflow-hidden">
              <div class="h-48 bg-cover bg-center relative" style="background-image: url('/accesorios.jpg')">
                <div class="absolute inset-0 bg-black bg-opacity-30 group-hover:bg-opacity-20 transition-all"></div>
              </div>
              <div class="p-4 text-center">
                <h3 class="font-bold text-black group-hover:text-gray-600 transition-colors tracking-wide uppercase">Accesorios</h3>
              </div>
            </div>
          </a>
        </div>
      </div>
    </section>

    <!-- Newsletter Section -->
    <section class="py-16 bg-black text-white">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-4 tracking-wide uppercase">
          No te pierdas nuestras ofertas
        </h2>
        <p class="text-xl text-gray-300 mb-8 font-medium">
          Suscr√≠bete y recibe descuentos exclusivos, nuevos productos y tendencias de moda
        </p>
        <div class="flex flex-col sm:flex-row max-w-md mx-auto gap-3">
          <input
            type="email"
            placeholder="Tu email aqu√≠..."
            class="flex-1 px-4 py-3 rounded-lg text-black placeholder-gray-500 focus:ring-2 focus:ring-gray-400 focus:outline-none border border-gray-300"
          />
          <button class="bg-white hover:bg-gray-100 text-black px-6 py-3 rounded-lg font-bold transition-colors whitespace-nowrap tracking-wide uppercase border border-white">
            Suscribirse
          </button>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<style>
  /* Hero Slider Styles */
  .hero-slider {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .hero-slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    opacity: 0;
    transition: opacity 2s ease-in-out;
    animation: slideShow 15s infinite;
  }

  .hero-slide.active {
    opacity: 1;
  }

  .hero-slide:nth-child(1) {
    animation-delay: 0s;
  }

  .hero-slide:nth-child(2) {
    animation-delay: 5s;
  }

  .hero-slide:nth-child(3) {
    animation-delay: 10s;
  }

  @keyframes slideShow {
    0% { opacity: 0; }
    6.67% { opacity: 1; }
    33.33% { opacity: 1; }
    40% { opacity: 0; }
    100% { opacity: 0; }
  }

  /* Smooth parallax effect */
  .hero-slide {
    transform: scale(1.1);
    animation: slideShow 15s infinite, parallaxZoom 15s infinite;
  }

  @keyframes parallaxZoom {
    0%, 33.33% { 
      transform: scale(1.1) translateX(0px); 
    }
    16.67% { 
      transform: scale(1.15) translateX(-20px); 
    }
    50% { 
      transform: scale(1.1) translateX(0px); 
    }
    66.67% { 
      transform: scale(1.15) translateX(20px); 
    }
    83.33% { 
      transform: scale(1.1) translateX(0px); 
    }
    100% { 
      transform: scale(1.1) translateX(0px); 
    }
  }
</style>

<script>
  // Hero slider functionality
  document.addEventListener('DOMContentLoaded', function() {
    const slides = document.querySelectorAll('.hero-slide');
    let currentSlide = 0;

    function showSlide(index: number) {
      slides.forEach((slide, i) => {
        slide.classList.toggle('active', i === index);
      });
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % slides.length;
      showSlide(currentSlide);
    }

    // Auto advance slides every 5 seconds
    setInterval(nextSlide, 5000);
    
    // Initialize first slide
    showSlide(0);
  });
</script>
